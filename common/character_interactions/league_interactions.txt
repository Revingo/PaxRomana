propose_to_enter_league_interaction = {
	category = interaction_category_diplomacy
	desc = propose_to_enter_league_interaction_desc
	ai_min_reply_days = 4
	ai_max_reply_days = 9
	icon = alliance

	send_name = propose_to_enter_league_interaction

	interface_priority = 60

	greeting = positive
	notification_text = ENTER_LEAGUE_NOTIFICATION

	is_shown = {
		scope:recipient = {
			NOT = { this = scope:actor }
			NOT = { is_allied_to = scope:actor }
			is_ruler = yes
			government_has_flag = government_is_city-state
			NOT = { has_variable = in_a_league }
		}
		scope:actor = {
			AND = {
				is_ruler = yes
				government_has_flag = government_is_city-state
				AND = {
					has_variable = in_a_league
					var:in_a_league = yes
				}
			
				NOT = { has_variable = league_owner }
			}
			
		}
	}
	
	is_valid_showing_failures_only = {
		scope:recipient = {
			is_landed = yes
			is_imprisoned = no
		}
		scope:actor = {
			is_landed = yes
			is_imprisoned = no
			NOT = {
				is_at_war_with = scope:recipient
			}
		}
		scope:recipient = { is_busy_in_events_localised = yes }
		custom_description = {
			text = "has_already_rejected_renegotiation"
			subject = scope:recipient
			NOT = {
				scope:actor = {
					has_opinion_modifier = {
						modifier = refused_alliance_opinion
						target = scope:recipient
					}
				}
			}
		}
	}

	is_valid = {

	}

	on_accept = {
		scope:actor = {
			trigger_event = char_interaction.0235
			if = {
				limit = {
					scope:hook = yes
					has_hook = scope:recipient
				}
				use_hook = scope:recipient
			}
		}
	
		hidden_effect = {
			scope:actor = {
				
				every_in_list = {
					variable = league_list
					
					create_alliance = {
						target = scope:recipient
						allied_through_owner = this
						allied_through_target = scope:recipient
					}
				}

				add_to_variable_list = {
					name = league_list
					target = scope:recipient
				}
			}
			scope:recipient = {
				set_variable = {
					name = in_a_league
					value = yes
				}
				set_variable = {
					name = league_owner
					value = scope:actor
				}
				add_character_modifier = {
					modifier = league_funds
				}
			}
		}
	}

	on_decline = {
		scope:actor = {
			trigger_event = char_interaction.0236
		}
		scope:actor = {
			add_opinion = {
				modifier = refused_alliance_opinion
				target = scope:recipient
			}
		}

		add_clan_unity_interaction_effect = {
			CHARACTER = scope:actor
			TARGET = scope:recipient
			VALUE = minor_unity_loss
			DESC = clan_unity_alliance_refusal.desc
			REVERSE_NON_HOUSE_TARGET = no
		}
	}

	ai_accept = {
		base = 100
	}
}

ban_from_league_interaction = {
	category = interaction_category_diplomacy
	desc = ban_from_league_interaction_desc
	ai_min_reply_days = 4
	ai_max_reply_days = 9
	icon = alliance

	send_name = ban_from_league_interaction

	interface_priority = 60

	greeting = positive
	notification_text = ENTER_LEAGUE_NOTIFICATION

	is_shown = {
		scope:recipient = {
			is_ruler = yes
			government_has_flag = government_is_city-state
			AND = {
				has_variable = in_a_league
				var:in_a_league = yes
			}
			AND = {
				has_variable = league_owner
				var:league_owner = scope:actor
			}
		}
		scope:actor = {
			NOT = { this = scope:recipient }
			is_ruler = yes
			government_has_flag = government_is_city-state
			AND = {
				has_variable = in_a_league
				var:in_a_league = yes
			}
			NOT = { has_variable = league_owner }
		}
	}
	
	is_valid_showing_failures_only = {
		scope:recipient = {
			is_landed = yes
			is_imprisoned = no
		}
		scope:actor = {
			is_landed = yes
			is_imprisoned = no
			NOT = {
				is_at_war_with = scope:recipient
			}
		}
		scope:recipient = { is_busy_in_events_localised = yes }
		custom_description = {
			text = "has_already_rejected_renegotiation"
			subject = scope:recipient
			NOT = {
				scope:actor = {
					has_opinion_modifier = {
						modifier = refused_alliance_opinion
						target = scope:recipient
					}
				}
			}
		}
	}

	is_valid = {

	}

	on_auto_accept = {
		scope:actor = {
			trigger_event = char_interaction.0235
			if = {
				limit = {
					scope:hook = yes
					has_hook = scope:recipient
				}
				use_hook = scope:recipient
			}
		}
		scope:recipient = {
			add_opinion = {
				target = scope:actor
				modifier = banned_me_from_league_opinion
			}
		}
	
		hidden_effect = {
			scope:actor = {
				
				every_in_list = {
					variable = league_list

					if = {
						limit = { NOT = {this = scope:recipient }}

						break_alliance =  scope:recipient
					}
				}

				remove_list_variable = {
					name = league_list
	
					target = scope:recipient
				}
			}
			scope:recipient = {
				remove_character_modifier = league_funds
				remove_variable = in_a_league
				remove_variable = league_owner
			}
		}
	}

	auto_accept = yes
	ai_will_do = {
		base = 0
	}
}

leave_league_interaction = {
	category = interaction_category_diplomacy
	desc = leave_league_interaction_desc
	ai_min_reply_days = 4
	ai_max_reply_days = 9
	icon = alliance

	send_name = leave_league_interaction

	interface_priority = 60

	greeting = positive
	notification_text = ENTER_LEAGUE_NOTIFICATION

	is_shown = {
		scope:recipient = {
			is_ruler = yes
			government_has_flag = government_is_city-state
			AND = {
				has_variable = in_a_league
				var:in_a_league = yes
			}
			NOT = { has_variable = league_owner }
		}
		scope:actor = {
			NOT = { this = scope:recipient }
			is_ruler = yes
			government_has_flag = government_is_city-state
			AND = {
				has_variable = in_a_league
				var:in_a_league = yes
			}
			AND = {
				has_variable = league_owner
				var:league_owner = scope:recipient
			}
			
		}
	}
	
	is_valid_showing_failures_only = {
		scope:recipient = {
			is_landed = yes
			is_imprisoned = no
		}
		scope:actor = {
			is_landed = yes
			is_imprisoned = no
			NOT = {
				is_at_war_with = scope:recipient
			}
		}
		scope:recipient = { is_busy_in_events_localised = yes }
		custom_description = {
			text = "has_already_rejected_renegotiation"
			subject = scope:recipient
			NOT = {
				scope:actor = {
					has_opinion_modifier = {
						modifier = refused_alliance_opinion
						target = scope:recipient
					}
				}
			}
		}
	}

	is_valid = {

	}

	on_auto_accept = {
		scope:actor = {
			trigger_event = char_interaction.0235
			if = {
				limit = {
					scope:hook = yes
					has_hook = scope:recipient
				}
				use_hook = scope:recipient
			}
		}
		scope:recipient = {
			every_in_list = {
				variable = league_list

				if = {
					limit = { NOT = {this = scope:actor }}

					add_opinion = {
						target = scope:actor
						modifier = left_league_opinion
					}
				}
			}
		}
	
		hidden_effect = {
			scope:recipient = {
				
				every_in_list = {
					variable = league_list

					if = {
						limit = { NOT = {this = scope:actor }}

						break_alliance =  scope:actor
					}
				}

				remove_list_variable = {
					name = league_list
	
					target = scope:actor
				}

				add_to_variable_list = {
					name = reintegrate_in_league
					target = scope:actor
				}
			}
			scope:actor = {
				remove_character_modifier = league_funds
				remove_variable = in_a_league
				remove_variable = league_owner
			}
		}
	}

	auto_accept = yes
	ai_will_do = {
		base = 0
	}
}